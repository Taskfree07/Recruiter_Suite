# Render.com Blueprint for ATS Resume Optimizer
# This file defines all services needed to deploy the application on Render.com
# For more info: https://render.com/docs/blueprint-spec

services:
  # Backend API Service
  - type: web
    name: ats-backend
    env: node
    region: oregon # Change to your preferred region (oregon, frankfurt, singapore)
    plan: free # Options: free, starter ($7), standard ($25)
    buildCommand: cd backend && npm install
    startCommand: cd backend && node src/server.js
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000
      - key: MONGODB_URI
        sync: false # Set this manually in Render dashboard (contains sensitive data)
      - key: GEMINI_API_KEY
        sync: false # Set this manually in Render dashboard (contains sensitive data)
      - key: CORS_ORIGIN
        fromService:
          type: web
          name: ats-frontend
          envVarKey: RENDER_EXTERNAL_URL
    autoDeploy: true

  # Frontend Static Site
  - type: web
    name: ats-frontend
    env: static
    region: oregon # Change to your preferred region
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/build
    headers:
      - path: /*
        name: X-Frame-Options
        value: SAMEORIGIN
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: X-XSS-Protection
        value: 1; mode=block
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: REACT_APP_API_URL
        fromService:
          type: web
          name: ats-backend
          envVarKey: RENDER_EXTERNAL_URL
    autoDeploy: true

# Database Notes:
# MongoDB is not directly supported by Render blueprints.
# You have two options:
#
# Option 1: MongoDB Atlas (Recommended)
# 1. Create a free MongoDB Atlas cluster at https://www.mongodb.com/cloud/atlas
# 2. Get your connection string
# 3. Set MONGODB_URI in Render dashboard for ats-backend service
#
# Option 2: Render Disk (Not recommended for production)
# You can run MongoDB as a private service, but it's not ideal for production use.

# To deploy:
# 1. Push this file to your repository
# 2. Go to Render Dashboard: https://dashboard.render.com
# 3. Click "New" -> "Blueprint"
# 4. Connect your GitHub/GitLab repository
# 5. Render will detect this render.yaml file
# 6. Configure the required environment variables:
#    - MONGODB_URI (your MongoDB connection string)
#    - GEMINI_API_KEY (your Google Gemini API key)
# 7. Click "Apply" to create all services
#
# Render will automatically:
# - Build and deploy both services
# - Set up SSL certificates
# - Configure networking between services
# - Set up auto-deploy on git push

# Custom Domain Setup (Optional):
# 1. After deployment, go to each service settings
# 2. Click "Custom Domain"
# 3. Add your domain (e.g., app.yourdomain.com for frontend, api.yourdomain.com for backend)
# 4. Update your DNS records as instructed
# 5. Update CORS_ORIGIN and REACT_APP_API_URL accordingly

# Upgrade Plans:
# Free Tier:
# - Services sleep after 15 mins of inactivity (cold starts)
# - 750 hours/month limit per service
# - Shared resources
#
# Starter Plan ($7/month per service):
# - Always on (no cold starts)
# - Better for production use
#
# Standard Plan ($25/month per service):
# - More resources
# - Better performance
# - Suitable for higher traffic

# Environment Variable Reference:
# Backend (ats-backend):
# - NODE_ENV: production (set automatically)
# - PORT: 5000 (set automatically)
# - MONGODB_URI: Your MongoDB connection string (SET MANUALLY)
# - GEMINI_API_KEY: Your Google Gemini API key (SET MANUALLY)
# - CORS_ORIGIN: Frontend URL (set automatically from frontend service)
#
# Frontend (ats-frontend):
# - REACT_APP_API_URL: Backend URL (set automatically from backend service)
